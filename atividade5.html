<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editor de √Årvores</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://d3js.org/d3.v7.min.js"></script> <!-- Carregando D3.js -->
</head>

<body>
  <h1>Editor de Estruturas de √Årvores</h1>
  
  <!-- Descri√ß√£o da Atividade -->
  <section class="description">
    <h2>Descri√ß√£o da Atividade</h2>
    <p>Na atividade proposta, voc√™ ir√° trabalhar com a estrutura da √°rvore vista na atividade 3. A ideia aqui √© adicionar duas fun√ß√µes ao nosso projeto: uma que busca um n√≥ espec√≠fico e outra que retorna esse n√≥, destacando-o.</p>

    <p>Por favor, siga as instru√ß√µes abaixo para preencher o c√≥digo completo no editor. Quando terminar, clique no bot√£o "Executar" para visualizar a √°rvore gerada.</p>

    <h3>1. Defini√ß√£o do N√≥</h3>
    <p>Primeiro, definimos a estrutura do n√≥. Cada n√≥ tem um valor (value) e uma lista de filhos (children).</p>
    <pre><code class="typescript" id="example-code">
  class Node {
      value: string;
      children: Node[];

      constructor(value: string) {
          this.value = value;
          this.children = [];
      }

      // M√©todo para adicionar um filho
      addChild(child: Node): void {
          this.children.push(child);
      }
  }
    </code></pre>

    <h3>2. Fun√ß√£o para Criar a √Årvore</h3>
    <p>Agora, criamos a √°rvore. Vamos definir uma fun√ß√£o chamada <code>createTaxonomyTree</code> que criar√° a √°rvore com os seguintes n√≥s:</p>
    <ul>
      <li><strong>Animalia</strong> ser√° a raiz da √°rvore.</li>
      <li><strong>Chordata</strong> ser√° filho de Animalia.</li>
      <li><strong>Mammalia</strong> ser√° filho de Chordata.</li>
      <li><strong>Primates</strong> e <strong>Carnivora</strong> ser√£o filhos de Mammalia.</li>
      <li><strong>Homo sapiens</strong> ser√° filho de Primates, e <strong>Canis lupus</strong> ser√° filho de Carnivora.</li>
      <li><strong>Aves</strong> ser√° filho de Chordata.</li>
      <li><strong>Passeriformes</strong> ser√° filho de Aves, e <strong>Corvus corax</strong> ser√° filho de Passeriformes.</li>
    </ul>
    <pre><code class="typescript" id="create-tree-code">
  function createTaxonomyTree(): Node {
      const animalia = new Node("Animalia");

      const chordata = new Node("Chordata");
      animalia.addChild(chordata);

      const mammalia = new Node("Mammalia");
      chordata.addChild(mammalia);

      const primates = new Node("Primates");
      mammalia.addChild(primates);
      primates.addChild(new Node("Homo sapiens"));

      const carnivora = new Node("Carnivora");
      mammalia.addChild(carnivora);
      carnivora.addChild(new Node("Canis lupus"));

      const aves = new Node("Aves");
      chordata.addChild(aves);

      const passeriformes = new Node("Passeriformes");
      aves.addChild(passeriformes);
      passeriformes.addChild(new Node("Corvus corax"));

      return animalia; // Retorna a √°rvore completa
  }
    </code></pre>

    <h3>3. Fun√ß√£o para Converter a √Årvore para a Estrutura "value" e "children"</h3>
    <p>Esta fun√ß√£o vai converter a √°rvore para a estrutura com os campos <strong>value</strong> (valor do n√≥) e <strong>children</strong> (filhos do n√≥). Isso facilita a visualiza√ß√£o e manipula√ß√£o da √°rvore.</p>
    <pre><code class="typescript" id="convert-code">
  function convertToTreeNode(node: Node): any {
      return {
          value: node.value,
          children: node.children.map(child => convertToTreeNode(child)), // Converte recursivamente os filhos
      };
  }
    </code></pre>

    <h3>4. Fun√ß√£o para Encontrar o N√≥</h3>
    <p>Esta fun√ß√£o vai encontrar um n√≥ na √°rvore. Isso √© √∫til para a visualiza√ß√£o e manipula√ß√£o de n√≥s espec√≠ficos na √°rvore.</p>
    <pre><code class="typescript" id="find-node-code">
  // Fun√ß√£o de busca
  function searchNode(root: Node, value: string): Node | undefined {
      if (root.value === value) {
          return root;
      }
      for (const child of root.children) {
          const found = searchNode(child, value);
          if (found) {
              return found;
          }
      }
      return undefined;
  }

  // Fun√ß√£o que retorna a √°rvore e o n√≥ destacado
  function getTaxonomyTree(): { tree: any; highlightedNode: string | null } {
      const taxonomyRoot = createTaxonomyTree();
      const nodeToHighlight = searchNode(taxonomyRoot, "Corvus corax");
      return {
          tree: convertToTreeNode(taxonomyRoot),
          highlightedNode: nodeToHighlight ? nodeToHighlight.value : null
      };
  }
    </code></pre>

    <h3>5. Executando o C√≥digo</h3>
    <p>Agora que voc√™ j√° tem as fun√ß√µes para definir o n√≥, criar a √°rvore e convert√™-la para a estrutura desejada, vamos executar o c√≥digo completo para visualizar o resultado.</p>

    <p>O pr√≥ximo passo √© criar a √°rvore utilizando a fun√ß√£o <code>createTaxonomyTree</code>, convert√™-la para a nova estrutura com a fun√ß√£o <code>convertToTreeNode</code>, e retornar a estrutura da √°rvore com o c√≥digo abaixo:</p>
    <pre><code class="typescript" id="execute-code">
  // Chamando a fun√ß√£o para obter os dados
  getTaxonomyTree();
    </code></pre>
  </section>


  <div class="container">
    <div class="editor-container">
      <textarea id="code-editor" placeholder="Escreva seu c√≥digo TypeScript aqui..."></textarea>
      <button id="run-code">Executar C√≥digo</button>
    </div>
    
    <div id="output-container">
      <h2>Visualiza√ß√£o da √Årvore</h2>
      <div id="tree-output"></div>
      <div class="celebration" id="celebration" style="display: none;">
        üéÜ Parab√©ns! Voc√™ acertou! üéÜ
      </div>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/typescript@4.9.4/lib/typescript.js"></script>
  
  <script>
    document.getElementById("run-code")?.addEventListener("click", () => {
      const userCode = document.getElementById("code-editor")?.value;
      const outputDiv = document.getElementById("tree-output");
      const celebrationDiv = document.getElementById("celebration");

      if (userCode && outputDiv) {
        try {
          // Limpa a √°rvore existente antes de renderizar uma nova
          outputDiv.innerHTML = "";

          // Compila o c√≥digo TypeScript para JavaScript
          const compiledCode = ts.transpile(userCode);
          
          // Executa o c√≥digo compilado utilizando eval
          const result = eval(compiledCode);
          
          // Renderiza a √°rvore no elemento de sa√≠da com D3
          if (result && result.tree) {
            renderTreeD3(result.tree, outputDiv, result.highlightedNode);
          }
        } catch (error) {
          outputDiv.innerHTML = `<span style="color: red;">Erro: ${error.message}</span>`;
        }
      }
    });

    // Fun√ß√£o para renderizar a √°rvore com D3.js
    function renderTreeD3(tree, container, highlightedNode) {
      const width = 600;
      const height = 300;
      const verticalOffset = 50; // Ajuste conforme necess√°rio

      const svg = d3.select(container)
        .append("svg")
        .attr("width", width)
        .attr("height", height + verticalOffset);

      const root = d3.hierarchy(tree); // Usando a estrutura hier√°rquica do D3

      const treeLayout = d3.tree().size([width, height - 100]);

      treeLayout(root); // Calculando as posi√ß√µes dos n√≥s

      // Adiciona os links entre os n√≥s
      svg.selectAll(".link")
        .data(root.links())
        .enter()
        .append("line")
        .attr("class", "link")
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y + verticalOffset)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y + verticalOffset)
        .attr("stroke", "#ccc");

      // Adiciona os n√≥s
      const nodes = svg.selectAll(".node")
        .data(root.descendants())
        .enter()
        .append("g")
        .attr("class", "node")
        .attr("transform", d => `translate(${d.x},${d.y + verticalOffset})`);

      nodes.append("circle")
        .attr("r", 10)
        .attr("fill", d => d.data.value === highlightedNode ? "#ff7f0e" : "#69b3a2");

      nodes.append("text")
        .attr("dy", -15)
        .attr("text-anchor", "middle")
        .text(d => d.data.value || "Node");

      // Adiciona um quadrado ao redor do n√≥ destacado
      if (highlightedNode) {
        nodes.filter(d => d.data.value === highlightedNode)
          .append("rect")
          .attr("x", -15)
          .attr("y", -15)
          .attr("width", 30)
          .attr("height", 30)
          .attr("fill", "none")
          .attr("stroke", "#ff7f0e")
          .attr("stroke-width", 2);
      }

      // Interatividade: ao passar o mouse sobre um n√≥
      nodes.on("mouseover", function (event, d) {
        d3.select(this)
          .select("circle")
          .attr("fill", "#ff7f0e");
      }).on("mouseout", function (event, d) {
        d3.select(this)
          .select("circle")
          .attr("fill", d.data.value === highlightedNode ? "#ff7f0e" : "#69b3a2");
      });
    }
  </script>
</body>
</html>