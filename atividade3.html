<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editor de 츼rvores</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://d3js.org/d3.v7.min.js"></script> <!-- Carregando D3.js -->
</head>

<body>
  <h1>Editor de Estruturas de 츼rvores</h1>
  
  <!-- Descri칞칚o da Atividade -->
  <section class="description">
    <h2>Descri칞칚o da Atividade</h2>
        <p>Na atividade proposta, voc칡 ir치 criar uma 치rvore bin치ria gen칠rica em TypeScript. A 치rvore bin치ria 칠 composta por n칩s, onde cada n칩 possui um valor, um ponteiro para o filho  esquerda e um ponteiro para o filho  direita. O objetivo 칠 entender a defini칞칚o de uma 치rvore bin치ria e como ela 칠 estruturada e manipulada atrav칠s de c칩digo.</p>

        <p>Por favor, siga as instru칞칫es abaixo para preencher o c칩digo completo no editor. Quando terminar, clique no bot칚o "Executar" para visualizar a 치rvore bin치ria gerada.</p>

        <h3>1. Defini칞칚o do N칩</h3>
        <p>Primeiro, definimos a estrutura do n칩. Cada n칩 tem um valor (data), um ponteiro para o filho  esquerda (left) e um ponteiro para o filho  direita (right).</p>
        <pre><code class="typescript" id="example-code">
class Node {
    data: number;
    left: Node | null;
    right: Node | null;

    constructor(data: number) {
        this.data = data;
        this.left = null;
        this.right = null;
    }
}
        </code></pre>

        <h3>2. Fun칞칚o para Criar a 츼rvore Bin치ria</h3>
        <p>Agora, criamos a 치rvore bin치ria. Vamos definir uma fun칞칚o chamada <code>createBinaryTree</code> que criar치 a 치rvore com os seguintes n칩s:</p>
        <ul>
            <li><strong>1</strong> ser치 a raiz da 치rvore.</li>
            <li><strong>2</strong> e <strong>3</strong> ser칚o os filhos de 1.</li>
            <li><strong>4</strong> e <strong>5</strong> ser칚o filhos de 2.</li>
        </ul>
        <pre><code class="typescript" id="create-tree-code">
function createBinaryTree(): Node {
    const root = new Node(1);        // Raiz da 치rvore
    root.left = new Node(2);         // N칩 esquerdo
    root.right = new Node(3);        // N칩 direito
    root.left.left = new Node(4);    // Filho esquerdo do n칩 2
    root.left.right = new Node(5);   // Filho direito do n칩 2

    return root; // Retorna a 치rvore bin치ria
}
        </code></pre>

        <h3>3. Fun칞칚o para Converter a 츼rvore Bin치ria para a Estrutura "value" e "children"</h3>
        <p>Esta fun칞칚o vai converter a 치rvore bin치ria em uma estrutura de 치rvore com os campos <strong>value</strong> (valor do n칩) e <strong>children</strong> (filhos do n칩). Isso facilita a visualiza칞칚o e manipula칞칚o da 치rvore.</p>
        <pre><code class="typescript" id="convert-code">
function convertToTreeNode(binaryNode: Node | null): any {
    if (binaryNode === null) return null;

    // Converte o n칩 bin치rio para a estrutura de 치rvore com "value" e "children"
    return {
        value: binaryNode.data.toString(),
        children: [
            convertToTreeNode(binaryNode.left), // Filho esquerdo
            convertToTreeNode(binaryNode.right), // Filho direito
        ].filter(child => child !== null), // Remove n칩s nulos (caso n칚o tenha filhos)
    };
}
        </code></pre>
        <h3>4. Executando o C칩digo</h3>
        <p>Agora que voc칡 j치 tem as fun칞칫es para definir o n칩, criar a 치rvore bin치ria e convert칡-la para a estrutura desejada, vamos executar o c칩digo completo para visualizar o resultado.</p>

        <p>O pr칩ximo passo 칠 criar a 치rvore bin치ria utilizando a fun칞칚o <code>createBinaryTree</code>, converter a 치rvore bin치ria para a nova estrutura com a fun칞칚o <code>convertToTreeNode</code>, e retornar a estrutura da 치rvore com o c칩digo abaixo:</p>
        <pre><code class="typescript" id="execute-code">
// Criando a 치rvore bin치ria
const rootNodeBinary = createBinaryTree();

// Convertendo a 치rvore bin치ria para a estrutura desejada
const rootNode = convertToTreeNode(rootNodeBinary);

// Retornando a estrutura da 치rvore
rootNode;
         </section>
  

  <div class="container"> <!-- Novo container para organizar o layout -->
    <div class="editor-container">
      <textarea id="code-editor" placeholder="Escreva seu c칩digo TypeScript aqui..."></textarea>
      <button id="run-code">Executar C칩digo</button>
    </div>
    
    <div id="output-container">
      <h2>Visualiza칞칚o da 츼rvore</h2>
      <div id="tree-output"></div>
      <div class="celebration" id="celebration" style="display: none;">
        游꾽 Parab칠ns! Voc칡 acertou! 游꾽
      </div>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/typescript@4.9.4/lib/typescript.js"></script>
  
  <script>
    document.getElementById("run-code")?.addEventListener("click", () => {
      const userCode = document.getElementById("code-editor")?.value;
      const outputDiv = document.getElementById("tree-output");
      const celebrationDiv = document.getElementById("celebration");

      if (userCode && outputDiv) {
        try {
          // Verifica se o c칩digo do usu치rio corresponde  defini칞칚o correta do n칩
          const expectedCode = `
            class Node {
              data: number;
              left: Node | null;
              right: Node | null;

              constructor(data: number) {
                this.data = data;
                this.left = null;
                this.right = null;
              }
            }
          `;
          
          // Remove espa칞os e quebras de linha para compara칞칚o
          if (userCode.trim().replace(/\s+/g, '') === expectedCode.trim().replace(/\s+/g, '')) {
            celebrationDiv.style.display = "block"; // Exibe a mensagem de Parab칠ns
          } else {
            celebrationDiv.style.display = "none"; // Esconde a mensagem se o c칩digo estiver errado
          }

          // Limpa a 치rvore existente antes de renderizar uma nova
          outputDiv.innerHTML = "";

          // Compila o c칩digo TypeScript para JavaScript
          const compiledCode = ts.transpile(userCode);
          
          // Executa o c칩digo compilado utilizando eval
          const result = eval(compiledCode);
          
          // Renderiza a 치rvore no elemento de sa칤da com D3
          if (result) {
            renderTreeD3(result, outputDiv);
          }
        } catch (error) {
          outputDiv.innerHTML = `<span style="color: red;">Erro: ${error.message}</span>`;
        }
      }
    });

    // Fun칞칚o para renderizar a 치rvore com D3.js
    function renderTreeD3(tree, container) {
      const width = 600;
      const height = 300;
      const verticalOffset = 50; // Ajuste conforme necess치rio

      const svg = d3.select(container)
        .append("svg")
        .attr("width", width)
        .attr("height", height + verticalOffset);

      const root = d3.hierarchy(tree); // Usando a estrutura hier치rquica do D3

      const treeLayout = d3.tree().size([width, height - 100]);

      treeLayout(root); // Calculando as posi칞칫es dos n칩s

      // Adiciona os links entre os n칩s
      svg.selectAll(".link")
        .data(root.links())
        .enter()
        .append("line")
        .attr("class", "link")
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y + verticalOffset)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y + verticalOffset)
        .attr("stroke", "#ccc");

      // Adiciona os n칩s
      const nodes = svg.selectAll(".node")
        .data(root.descendants())
        .enter()
        .append("g")
        .attr("class", "node")
        .attr("transform", d => `translate(${d.x},${d.y + verticalOffset})`);

      nodes.append("circle")
        .attr("r", 10)
        .attr("fill", "#69b3a2");

      nodes.append("text")
        .attr("dy", -15)
        .attr("text-anchor", "middle")
        .text(d => d.data.value || "Node");

      // Interatividade: ao passar o mouse sobre um n칩
      nodes.on("mouseover", function (event, d) {
        d3.select(this)
          .select("circle")
          .attr("fill", "#ff7f0e");
      }).on("mouseout", function (event, d) {
        d3.select(this)
          .select("circle")
          .attr("fill", "#69b3a2");
      });
    }
  </script>
</body>
</html>
